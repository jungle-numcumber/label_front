"use strict";(self.webpackChunklabel_front=self.webpackChunklabel_front||[]).push([[891],{8891:function(e,t,n){n.r(t),n.d(t,{default:function(){return De}});var r,i,o=n(1413),a=n(4165),s=n(5861),c=n(9439),l=n(4569),u=n.n(l),d=n(2791),h=n(6871),g=(n(8890),n(5671)),f=n(3144),p=n(136),m=n(9388),x=n(9407),v=n(548),y=n(5712),_=n(641),N=n(5141),k=n(6983),S=n(3126),w=n(381),I=n(6337),b=n(8789),j=n(4428),Z=n(184),P=function(e){(0,p.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,g.Z)(this,n),i=t.call(this,e),r=(0,j.ZP)("https://tradingstudy.shop:443",{transports:["websocket"],query:{userId:String(i.props.userIdx),pdfId:String(i.props.pdfIdx)}}),i.state={fp:{},flag:!1},r.on("connect",(function(){r.once("updateEditorOnce",(function(e){i.setState({fp:e,flag:!0})}))})),-1!==i.props.commitIdx&&r.disconnect(),i}return(0,f.Z)(n,[{key:"render",value:function(){return(0,Z.jsx)("div",{children:this.state.flag&&(0,Z.jsx)(F,{value:this.state.fp,markdownValue:this.props.markdownValue,commitIdx:this.props.commitIdx,userIdx:this.props.userIdx,pdfIdx:this.props.pdfIdx})})}},{key:"componentWillUnmount",value:function(){null!=r&&!0===r.connected&&r.disconnect()}}]),n}(d.Component);function L(e,t,n){i=setTimeout((function(){r.emit("updateEditor",{id:e,pdfId:t,text:n},clearTimeout(i))}),700)}function B(e,t,n){return E.apply(this,arguments)}function E(){return(E=(0,s.Z)((0,a.Z)().mark((function e(t,n,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i?(clearTimeout(i),L(t,n,r)):L(t,n,r);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e,t){return H.apply(this,arguments)}function H(){return(H=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(n);case 2:return r=e.sent,i=r.preSignedUrl,o=r.fileName,e.next=7,D(t,o);case 7:return s=e.sent,c="https://label-editor.s3.ap-northeast-2.amazonaws.com/".concat(o),e.next=11,A(i.signedUrlPut,s);case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){return T.apply(this,arguments)}function T(){return(T=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=Math.random().toString(36).substring(2,11),r="".concat(t,"_").concat(n,".png"),e.next=5,u().post("https://tradingstudy.shop:443/users/sign",{fileName:r});case 5:return i=e.sent,e.abrupt("return",{preSignedUrl:i.data,fileName:r});case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function D(e,t){return M.apply(this,arguments)}function M(){return(M=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=t.split(","),i=r[0].match(/:(.*?);/)[1],o=atob(r[1]),s=o.length,c=new Uint8Array(s);s--;)c[s]=o.charCodeAt(s);return e.abrupt("return",new File([c],n,{type:i}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t){return G.apply(this,arguments)}function G(){return(G=(0,s.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"PUT",body:n,headers:{"x-amz-acl":"public-read","Content-Type":"image/png"}});case 2:e.sent;case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var F=function(e){var t=e.value,n=e.markdownValue,r=e.commitIdx,i=e.userIdx,o=e.pdfIdx,c=(0,_.jE)((function(e,c){var l=x.ML.make().config((function(c){c.set(x.KP,e),-1===r&&t?c.set(x.Dn,{type:"json",value:t}):-1===r&&0===Object.keys(t).length?c.set(x.Dn,""):(c.set(x.Dn,{type:"json",value:n}),console.log(n)),c.get(v.QC).updated(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(n,r,s){var c,l,u,d,h,g,f,p,m;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=r.toJSON(),console.log("jsonOutput: ",c),l=c.content,u=0;case 4:if(!(u<l.length)){e.next=31;break}if(!l[u].content){e.next=28;break}d=0;case 7:if(!(d<l[u].content.length)){e.next=28;break}if(h=l[u].content[d],g=h.type,f=h.attrs,console.log("contentAttr",f),void 0===f||f.title){e.next=23;break}return f.title="try",console.log("it is not stored yet!!"),p=f.src,e.next=18,C(p,i);case 18:m=e.sent,console.log("imagesrc:",m),f.src=m,e.next=24;break;case 23:"image"===g&&console.log("it is alread loaded!!");case 24:console.log(l[u],h,g);case 25:d++,e.next=7;break;case 28:u++,e.next=4;break;case 31:return e.next=33,B(i,o,c);case 33:return e.abrupt("return",t);case 34:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}())})).use(k.Ge).use(w.GI).use(N.Qn).use(b.m8).use(I.r0).use(S.mA).use(y.M).use(v.X3);return l}),[r,n]),l=c.editor;c.loading,c.getInstance;return(0,d.useEffect)((function(){var e,t,n;null===(e=document.querySelector(".ProseMirror.editor"))||void 0===e||e.setAttribute("ondrop","drop_handler(event)"),null===(t=document.querySelector(".ProseMirror.editor"))||void 0===t||t.setAttribute("ondragover","dragover_handler(event)");var i,o,a=null===(n=document.querySelector(".PersonalReading__mainPage"))||void 0===n?void 0:n.clientHeight;null!=a&&(null===(i=document.querySelector(".milkdown"))||void 0===i||i.setAttribute("style","height: ".concat(a-240,"px")));-1!==r&&(null===(o=document.querySelector(".ProseMirror.editor"))||void 0===o||o.setAttribute("contenteditable","false"))})),(0,Z.jsx)(_.F3,{editor:l})};var O=function(e){return(0,Z.jsx)("div",{dangerouslySetInnerHTML:{__html:e.html}})},q="HighlightList_wrap__5AIyL",U="HighlightList_container__aHWyH",Y="HighlightList_title__hmW+d",V="HighlightList_highlightInfo__StQzz",z={searchBar:"SearchBar_searchBar__nTkuX",search:"SearchBar_search__rUkCI",searchButton:"SearchBar_searchButton__kyrsF",searchInput:"SearchBar_searchInput__64lOR"},K=n(4483),W=n(3174);var Q=function(e){return(0,Z.jsxs)("form",{className:z.searchBar,onSubmit:function(e){!function(e){e.preventDefault()}(e)},children:[(0,Z.jsx)("button",{className:z.searchButton,children:(0,Z.jsx)(K.G,{icon:W.Y$T,className:z.searchIcon})}),(0,Z.jsx)("input",{className:z.searchInput,type:"text",id:"search",onChange:function(t){if(""===t.target.value){var n=function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u().get("https://inkyuoh.shop/highlights/pdfs/".concat(e.pdfIdx,"/pages/").concat(e.currentPageNumber)).then((function(t){console.log("Search highlight data response:",t),e.setHighlightData(t.data.result)})).catch((function(e){console.log("Search highlight data Fail, error:",e)}));case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();n()}else{var r=function(){var n=(0,s.Z)((0,a.Z)().mark((function n(){return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u().get("https://inkyuoh.shop/pdfs/".concat(e.pdfIdx,"/highlights/search?keyword=").concat(t.target.value)).then((function(t){console.log("Search highlight data response:",t),e.setHighlightData(t.data.result.sort((function(e,t){return e.pageNum-t.pageNum})))})).catch((function(e){console.log("Search highlight data Fail, error:",e)}));case 2:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();r()}},placeholder:"\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694."})]})};var X=n(7621),J=n(9504),$=n(9585),ee=n(890),te=n(3044),ne=n(5130),re=n(3400);function ie(e){var t;function n(){return(n=(0,s.Z)((0,a.Z)().mark((function t(n,r,i,o,c,l){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(-1!==n){t.next=3;break}return t.next=3,u().delete("https://inkyuoh.shop/highlights/".concat(r)).then((function(e){console.log("highlight delete response:",e)})).catch((function(e){console.log("highlight delete error:",e)})).then((0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u().get("https://inkyuoh.shop/highlights/pdfs/".concat(e.pdfIdx,"/pages/").concat(l)).then((function(e){i(e.data.result),c(!o);for(var t=document.getElementsByClassName("highlight"+r),n=0;n<t.length;n++)!0===t[n].classList.contains("highlightedGreen")&&t[n].classList.remove("highlightedGreen"),!0===t[n].classList.contains("highlightedPurple")&&t[n].classList.remove("highlightedPurple"),!0===t[n].classList.contains("highlightedYellow")&&t[n].classList.remove("highlightedYellow")}));case 2:case"end":return t.stop()}}),t)}))));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return console.log(e.highlightData),(0,Z.jsx)(Z.Fragment,{children:null===(t=e.highlightData)||void 0===t?void 0:t.map((function(t,r){return(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsxs)(X.Z,{sx:{width:"100%",minWidth:275,marginBottom:1},children:[(0,Z.jsx)($.Z,{sx:{paddingBottom:0},avatar:(0,Z.jsx)(te.Z,{sx:{width:10,height:10,bgcolor:0===t.color?"#93E7A2":1===t.color?"#9747FF":2===t.color?"#FFD644":null},"aria-label":"recipe",children:""}),title:"p."+"".concat(t.pageNum),action:-1===e.commitIdx?(0,Z.jsx)(re.Z,{onClick:function(){!function(e,t,r,i,o,a){n.apply(this,arguments)}(e.commitIdx,t.highlightIdx,e.setHighlightData,e.updateHighlightList,e.setUpdateHighlightList,e.currentPageNumber)},children:(0,Z.jsx)(ne.Z,{fontSize:"small"})}):null}),(0,Z.jsx)(J.Z,{sx:{paddingTop:"4px"},children:(0,Z.jsx)(ee.Z,{sx:{fontSize:14},color:"text.secondary",draggable:"true",onDragStart:function(e){!function(e){e.dataTransfer.setData("text/plain",e.target.innerHTML)}(e)},children:t.data})})]},r)})}))})}var oe=function(e){var t=(0,d.useState)([]),n=(0,c.Z)(t,2),r=n[0],i=n[1];return(0,d.useEffect)((function(){if(-1===e.commitIdx){var t=function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u().get("https://inkyuoh.shop/highlights/pdfs/".concat(e.pdfIdx,"/pages/").concat(e.currentPageNumber)).then((function(e){i(e.data.result)}));case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}else{var n=function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u().get("https://inkyuoh.shop/highlights/pages/".concat(e.currentPageNumber,"/commitIdx/").concat(e.commitIdx)).then((function(e){i(e.data.result)}));case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();n()}}),[e.currentPageNumber,e.updateHighlightList,e.commitIdx]),(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)("div",{}),(0,Z.jsx)("div",{className:Y,children:"Highlights"}),(0,Z.jsx)(Q,{pdfIdx:e.pdfIdx,currentPageNumber:e.currentPageNumber,highlightData:r,setHighlightData:i}),(0,Z.jsx)("div",{className:V}),(0,Z.jsx)("aside",{className:q,children:(0,Z.jsx)("div",{className:U,children:(0,Z.jsx)(ie,{commitIdx:e.commitIdx,pdfIdx:e.pdfIdx,highlightData:r,setHighlightData:i,style:{overflow:"scroll"},updateHighlightList:e.updateHighlightList,setUpdateHighlightList:e.setUpdateHighlightList,currentPageNumber:e.currentPageNumber})})})]})},ae=n(1171),se=n(1034),ce=((0,ae.ZP)((function(e){return(0,Z.jsx)(se.Z,(0,o.Z)({focusVisibleClassName:".Mui-focusVisible",disableRipple:!0},e))}))((function(e){var t=e.theme;return{width:42,height:26,padding:0,"& .MuiSwitch-switchBase":{padding:0,margin:2,transitionDuration:"300ms","&.Mui-checked":{transform:"translateX(16px)",color:"#fff","& + .MuiSwitch-track":{backgroundColor:"dark"===t.palette.mode?"#2ECA45":"#93E8DE",opacity:1,border:0},"&.Mui-disabled + .MuiSwitch-track":{opacity:.5}},"&.Mui-focusVisible .MuiSwitch-thumb":{color:"#33cf4d",border:"6px solid #fff"},"&.Mui-disabled .MuiSwitch-thumb":{color:"light"===t.palette.mode?t.palette.grey[100]:t.palette.grey[600]},"&.Mui-disabled + .MuiSwitch-track":{opacity:"light"===t.palette.mode?.7:.3}},"& .MuiSwitch-thumb":{boxSizing:"border-box",width:22,height:22},"& .MuiSwitch-track":{borderRadius:13,backgroundColor:"light"===t.palette.mode?"#E9E9EA":"#39393D",opacity:1,transition:t.transitions.create(["background-color"],{duration:500})}}})),"SideBar_sideBarContents__KmwNy"),le="SideBar_bookInfo__+AGC2",ue="SideBar_bookImage__o80DQ",de="SideBar_bookTitle__4hT75",he="SideBar_historyContainer__laxyt",ge="SideBar_historyTitle__iYLbi",fe="SideBar_historyInput__3t5Oq",pe="SideBar_historyWrap__Ih9xV",me="SideBar_historyUnorderedListTag__KWQHM",xe="SideBar_historyMessage__kdmFK",ve="SideBar_historyDateAndIcon__Ihenq",ye="SideBar_historyDate__Vax62",_e="SideBar_historyIcon__-+mfK",Ne="SideBar_sideBarToggleButton__D3HGR",ke=n(7892),Se=n.n(ke),we=n(3767),Ie=n(9525),be=n(9658);function je(e){var t;return(0,Z.jsx)(Z.Fragment,{children:null===(t=e.commitsInfo)||void 0===t?void 0:t.map((function(t,n){return(0,Z.jsx)("ul",{className:me,onClick:function(){!function(t){e.setCommitIdx(t.commitIdx)}(t)},children:(0,Z.jsxs)("li",{children:[(0,Z.jsx)("p",{className:xe,children:t.commitMessage}),(0,Z.jsxs)("div",{className:ve,children:[(0,Z.jsx)("p",{className:ye,children:t.createdAt.substring(2)}),(0,Z.jsxs)("div",{className:_e,children:[(0,Z.jsx)(K.G,{icon:W.Mdf}),(0,Z.jsx)(K.G,{style:{marginLeft:"4px"},icon:W.paY})]})]})]})},n)}))})}var Ze=function(e){var t=(0,d.useState)(!1),n=(0,c.Z)(t,2),r=n[0],i=n[1],a=(0,d.useState)([]),s=(0,c.Z)(a,2),l=s[0],h=s[1],g=(0,d.useRef)(),f=Se()().format("YYYY-MM-DD HH:mm:ss");(0,d.useEffect)((function(){u().get("https://inkyuoh.shop/commits/users/".concat(58,"/books/").concat(e.currentBookInfo.pdfIdx)).then((function(e){var t,n;console.log(e),h(null===e||void 0===e||null===(t=e.data)||void 0===t||null===(n=t.result)||void 0===n?void 0:n.reverse())})).catch((function(e){console.log(e)}))}),[r]);var p=(0,d.useState)(!1),m=(0,c.Z)(p,2),x=m[0],v=m[1],y=(0,d.useState)(!1),_=(0,c.Z)(y,2),N=_[0],k=_[1],S=function(e,t){"clickaway"!==t&&(v(!1),k(!1))},w=d.forwardRef((function(e,t){return(0,Z.jsx)(be.Z,(0,o.Z)({elevation:6,ref:t,variant:"filled"},e))}));return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)("div",{className:ce,style:!0===r?{}:{display:"none"},children:[(0,Z.jsxs)("div",{className:le,children:[(0,Z.jsx)("div",{className:ue,style:{backgroundImage:"url("+"".concat(""+"".concat(e.currentBookInfo.firstPageLink))}}),(0,Z.jsx)("p",{className:de,children:e.currentBookInfo.pdfName})]}),(0,Z.jsx)("hr",{style:{width:"100%",marginTop:24,marginBottom:24,marginLeft:24,marginRight:16}}),(0,Z.jsxs)("div",{className:he,children:[(0,Z.jsx)("div",{className:ge,children:"History"}),(0,Z.jsx)("form",{onSubmit:function(t){!function(t){t.preventDefault(),""!==g.current.value?(u().post("https://inkyuoh.shop/commits",{pdfIdx:e.currentBookInfo.pdfIdx,userIdx:58,createdAt:f,commitMessage:g.current.value}).then((function(t){console.log("Commit response:",t),u().get("https://inkyuoh.shop/commits/users/".concat(58,"/books/").concat(e.currentBookInfo.pdfIdx)).then((function(e){var t,n;console.log("Reset commitsInfo response:",e),h(null===e||void 0===e||null===(t=e.data)||void 0===t||null===(n=t.result)||void 0===n?void 0:n.reverse()),v(!0)})).catch((function(e){console.log("Reset commitsInfo Fail, error:",e)}))})).catch((function(e){console.log("Commit Fail, error:",e)})),g.current.value=null):k(!0)}(t)},children:(0,Z.jsx)("input",{ref:g,className:fe,placeholder:"\uae30\ub85d\uc744 \ub0a8\uae30\uc138\uc694."})}),(0,Z.jsx)("div",{className:pe,children:(0,Z.jsx)(je,{commitIdx:e.commitIdx,setCommitIdx:e.setCommitIdx,commitsInfo:l})})]}),(0,Z.jsxs)(we.Z,{spacing:2,sx:{width:"100%"},children:[(0,Z.jsx)(Ie.Z,{open:x,autoHideDuration:4500,onClose:S,children:(0,Z.jsx)(w,{onClose:S,severity:"success",sx:{width:"100%"},children:"\uc800\uc7a5\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."})}),(0,Z.jsx)(Ie.Z,{open:N,autoHideDuration:4500,onClose:S,children:(0,Z.jsx)(w,{onClose:S,severity:"error",sx:{width:"100%"},children:"\uae30\ub85d \ub0b4\uc6a9\uc744 \uc791\uc131\ud574\uc8fc\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4."})})]})]}),(0,Z.jsx)(K.G,{icon:!0===r?W.EyR:W.yOZ,className:Ne,onClick:function(){i(!r)}})]})},Pe=n(5498),Le=n.n(Pe),Be=n(5125);function Ee(e,t,n,r,i,o,a){null===a||void 0===a||a.stopPropagation();for(var s=window.getSelection().toString().trim(),c=window.getSelection().getRangeAt(0),l=window.getSelection().getRangeAt(0).startContainer,d=window.getSelection().getRangeAt(0).endContainer,h=l.parentElement,g=d.parentElement,f=c.startOffset,p=0,m=0;m<h.childNodes.length;m++)h.childNodes[m]===l&&(p=m);for(var x=c.endOffset,v=0,y=0;y<g.childNodes.length;y++)g.childNodes[y]===d&&(v=y);function _(e,t){return!0===e.classList.toString().includes("y")?e.classList:_(e.parentElement,t+1)}var N,k=_(h,0)[4],S=_(g,0)[4];"highlightedGreen"===o&&(N=0),"highlightedPurple"===o&&(N=1),"highlightedYellow"===o&&(N=2);var w={pdfIdx:e,pageNum:t,startLine:k,startOffset:f,startNode:p,endLine:S,endOffset:x,endNode:v,data:s,color:N};u().post("https://inkyuoh.shop/highlights",{pdfIdx:e,pageNum:t,startLine:k,startOffset:f,startNode:p,endLine:S,endOffset:x,endNode:v,data:s,color:N}).then((function(e){console.log("Highlight POST Success\nresponse:",e),i(!r)})).catch((function(e){console.log("Highlight POST Fail\nerror:",e)})).then((function(){u().get("https://inkyuoh.shop/highlights/pdfs/".concat(e,"/pages/").concat(t)).then((function(e){Ce(w,e.data.result[e.data.result.length-1].highlightIdx)}))})),n.current.style.display="none"}function Ce(e,t){var n,r=e.startLine,i=e.startOffset,o=e.startNode,a=e.endLine,s=e.endOffset,c=e.endNode,l=parseInt(r.slice(1),16),u=parseInt(a.slice(1),16);0===e.color&&(n="highlightedGreen"),1===e.color&&(n="highlightedPurple"),2===e.color&&(n="highlightedYellow");for(var d=l;d<=u;d++){var h=document.getElementsByClassName("y".concat(d.toString(16)))[0],g=document.createRange(),f=document.createElement("span");if(f.classList.add(n),f.classList.add("highlight"+t),l===u)return g.setStart(null===h||void 0===h?void 0:h.childNodes[o],i),g.setEnd(null===h||void 0===h?void 0:h.childNodes[c],s),void He(g,f);d===l?(g.setStart(null===h||void 0===h?void 0:h.childNodes[o],i),g.setEnd(null===h||void 0===h?void 0:h.childNodes[h.childNodes.length-1],h.childNodes[h.childNodes.length-1].length)):d===u?(g.setStart(null===h||void 0===h?void 0:h.childNodes[0],0),g.setEnd(null===h||void 0===h?void 0:h.childNodes[c],s)):(g.setStart(null===h||void 0===h?void 0:h.childNodes[0],0),g.setEnd(null===h||void 0===h?void 0:h.childNodes[h.childNodes.length-1],h.childNodes[h.childNodes.length-1].length)),He(g,f)}}function He(e,t){t.appendChild(e.extractContents()),e.insertNode(t)}function Re(e,t,n,r){if("back"===e){if(1===t)return;n((function(e){return e-1}))}if("go"===e){if(t===r)return;n((function(e){return e+1}))}}var Te=n(3239);var De=function(e){var t=(0,h.TH)().state,n=t.pdfIdx,r=t.recentlyReadPage,i=(0,d.useState)(""),l=(0,c.Z)(i,2),g=l[0],f=l[1],p=(0,d.useState)(!0),m=(0,c.Z)(p,2),x=m[0],v=m[1],y=(0,d.useState)(-1),_=(0,c.Z)(y,2),N=_[0],k=_[1],S=(0,d.useState)({}),w=(0,c.Z)(S,2),I=w[0],b=w[1],j=(0,d.useState)([]),L=(0,c.Z)(j,2),B=L[0],E=L[1],C=(0,d.useState)(!1),H=(0,c.Z)(C,2),R=H[0],T=H[1],D=(0,d.useRef)(),M=(0,d.useRef)(),A=(0,d.useRef)(),G=(0,d.useRef)(),F=(0,d.useState)(r),q=(0,c.Z)(F,2),U=q[0],Y=q[1],V=(0,d.useState)({}),z=(0,c.Z)(V,2),Q=z[0],X=z[1];return(0,d.useEffect)((function(){u().get("https://inkyuoh.shop/users/".concat(58,"/pdfs")).then((function(e){console.log("TotalPage GET response:",e);var t=e.data.result.find((function(e){return e.pdfIdx===n}));X(t)})).catch((function(e){console.log("TotalPage GET Fail, error:",e)}))}),[n]),(0,d.useEffect)((function(){if(-1===N){var e=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().get("https://inkyuoh.shop/pdfs/".concat(n,"/pages/").concat(U)).then((function(e){return e.data.result.pageLink}));case 2:return t=e.sent,e.next=5,u().get("".concat(t)).then((function(e){f(e.data)}));case 5:return e.sent,e.next=8,u().get("https://inkyuoh.shop/highlights/pdfs/".concat(n,"/pages/").concat(U)).then((function(e){E(e.data.result)}));case 8:e.sent;case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}else{var t=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().get("https://inkyuoh.shop/pdfs/".concat(n,"/pages/").concat(U)).then((function(e){return e.data.result.pageLink}));case 2:return t=e.sent,e.next=5,u().get("".concat(t)).then((function(e){f(e.data)}));case 5:return e.sent,e.next=8,u().get("https://inkyuoh.shop/highlights/pages/".concat(U,"/commitIdx/").concat(N)).then((function(e){E(e.data.result)}));case 8:e.sent;case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t()}}),[U,e.mode,N]),(0,d.useEffect)((function(){f((0,o.Z)({},g)),-1!==N&&u().post("https://inkyuoh.shop/commits/books/2/2",{commitIdx:N}).then((function(e){return JSON.parse(e.data.result[0].editorLog)})).then((function(e){console.log(e),b(e)}))}),[N]),(0,d.useEffect)((function(){try{for(var e=0;e<B.length;e++)Ce(B[e],B[e].highlightIdx)}catch(t){}}),[B,N]),(0,d.useEffect)((function(){function e(e){var t=D.current;setTimeout((function(){if(0!=window.getSelection().toString().trim()){var n=e.pageX,r=e.pageY,i=Number(getComputedStyle(t).width.slice(0,-2)),o=Number(getComputedStyle(t).width.slice(0,-2));t.style.left="".concat(n-.5*i,"px"),t.style.top="".concat(r-1*o,"px"),t.style.display="flex",t.classList.add("btnEntrance")}}),0)}var t=document.querySelectorAll(".PersonalReading__mainPage--readingPage");function n(e){var t=D.current;"flex"===t.style.display&&!1===e.target.classList.contains("specific")&&(t.style.display="none",t.classList.remove("btnEntrance"),window.getSelection().empty())}return null===t||void 0===t||t.forEach((function(t){null===t||void 0===t||t.addEventListener("mouseup",e),null===t||void 0===t||t.addEventListener("touchend",e,!1)})),document.addEventListener("mousedown",n),document.addEventListener("touchstart",n,!1),document.querySelectorAll(".c").forEach((function(e){e.style.height="110%"})),document.querySelectorAll(".t").forEach((function(e){e.style.height="2.1em"})),function(){null===t||void 0===t||t.forEach((function(t){null===t||void 0===t||t.removeEventListener("mouseup",e),null===t||void 0===t||t.removeEventListener("touchend",e)})),document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}}),[g]),(0,Z.jsxs)("main",{className:"PersonalReading",children:[R&&(0,Z.jsx)(Te.Z,{className:"CircularProgress"}),(0,Z.jsxs)("div",{ref:D,className:"HighlightButton__wrap",children:[(0,Z.jsx)("button",{ref:M,className:"HighlightButton specific",onTouchStart:function(e){Ee(n,U,D,x,v,"highlightedGreen",e)},onClick:function(){Ee(n,U,D,x,v,"highlightedGreen")}}),(0,Z.jsx)("button",{ref:A,className:"HighlightButton__purple specific",onTouchStart:function(e){Ee(n,U,D,x,v,"highlightedPurple",e)},onClick:function(){Ee(n,U,D,x,v,"highlightedPurple")}}),(0,Z.jsx)("button",{ref:G,className:"HighlightButton__yellow specific",onTouchStart:function(e){Ee(n,U,D,x,v,"highlightedYellow",e)},onClick:function(){Ee(n,U,D,x,v,"highlightedYellow")}})]}),(0,Z.jsxs)("div",{className:"PersonalReading__container",style:!0===R?{opacity:.8}:null,children:[(0,Z.jsx)("aside",{className:"PersonalReading__sideBar",children:(0,Z.jsx)(Ze,{commitIdx:N,setCommitIdx:k,currentBookInfo:Q})}),(0,Z.jsxs)("div",{className:"PersonalReading__mainPage",style:!0===e.mode?{flex:3}:{flex:1},children:[!0===e.mode?(0,Z.jsxs)("article",{className:"PersonalReading__mainPage--readingPage",style:!0===e.mode?{flex:2}:{flex:0},children:[(0,Z.jsx)(O,{className:"PageRendered",html:g}),(0,Z.jsxs)("div",{className:"PersonalReading__mainPage--goBackButtons",children:[(0,Z.jsx)(K.G,{icon:W.Uu6,className:"backButton",onClick:function(){Re("back",U,Y,Q.totalPage)}}),(0,Z.jsx)(K.G,{icon:W.I4f,className:"goButton",onClick:function(){Re("go",U,Y,Q.totalPage)}})]}),(0,Z.jsx)("div",{className:"PersonalReading__mainPage--info",children:(0,Z.jsxs)("p",{children:[(0,Z.jsx)("input",{className:"PersonalReading__mainPage--info--input",placeholder:U,onKeyUp:function(e){e.preventDefault(),13===window.event.keyCode&&1<=e.target.value&&e.target.value<=Q.totalPage&&(Y(Number(e.target.value)),e.target.value=null)}})," / ",Q.totalPage]})})]}):null,(0,Z.jsx)("aside",{className:"PersonalReading__highlightList",style:(e.mode,{flex:1}),children:(0,Z.jsx)(oe,{mode:e.mode,commitIdx:N,setCommitIdx:k,pdfIdx:n,totalPage:Q.totalPage,currentPageNumber:U,updateHighlightList:x,setUpdateHighlightList:v})})]}),(0,Z.jsxs)("article",{className:"PersonalReading__mainPage--textEditor",style:(e.mode,{flex:1}),children:[(0,Z.jsxs)("div",{className:"PersonalReading__mainPage--textEditor--wrap",children:[(0,Z.jsxs)("div",{className:"PersonalReading__mainPage--textEditor--info",children:[(0,Z.jsx)("h1",{children:Q.pdfName}),(0,Z.jsx)("p",{children:Q.author})]}),(0,Z.jsx)(K.G,{className:"ToPdfButton",icon:W.gSj,onClick:function(){T(!0),setTimeout((function(){!function(e){var t,n,r,i;null===(t=document.querySelector(".editor"))||void 0===t||t.setAttribute("style","overflow: visible !important"),null===(n=document.querySelector(".editor"))||void 0===n||n.setAttribute("style","height: auto !important"),Le()(document.querySelector(".editor")).then((function(t){var n=t.toDataURL("image/png"),r=180,i=1.414*r,o=t.height*r/t.width,a=o,s=new Be.ZP("p","mm","a4"),c=0;for(s.addImage(n,"PNG",20,c,r,o),a-=i;a>=0;)c=a-o,s.addPage(),s.addImage(n,"PNG",20,c,r,o),a-=i;s.save("".concat(e,".pdf"))})),null===(r=document.querySelector(".editor"))||void 0===r||r.setAttribute("style","overflow: scroll !important"),null===(i=document.querySelector(".editor"))||void 0===i||i.setAttribute("style","height: 100% !important")}(Q.pdfName),setTimeout((function(){T(!1)}),500)}),100)}})]}),(0,Z.jsx)(P,{markdownValue:I,commitIdx:N,userIdx:String(58),pdfIdx:String(n)})]})]})]})}}}]);
//# sourceMappingURL=891.989ada8c.chunk.js.map