"use strict";(self.webpackChunklabel_front=self.webpackChunklabel_front||[]).push([[891],{8891:function(t,e,n){n.r(e),n.d(e,{default:function(){return Mt}});var r,i,o=n(1413),a=n(4165),s=n(5861),c=n(9439),l=n(4569),u=n.n(l),d=n(2791),h=n(6871),g=n(8890),f=n.n(g),p=n(5671),m=n(3144),x=n(136),v=n(9388),y=n(9407),_=n(548),k=n(5712),w=n(641),N=n(5141),S=n(6983),b=n(3126),I=n(381),j=n(6337),Z=n(8789),P=n(4428),L=n(184),B=function(t){(0,x.Z)(n,t);var e=(0,v.Z)(n);function n(t){var i;return(0,p.Z)(this,n),i=e.call(this,t),r=(0,P.ZP)("https://tradingstudy.shop:443",{transports:["websocket"],query:{userId:String(i.props.userIdx),pdfId:String(i.props.pdfIdx)}}),i.state={fp:{},flag:!1},r.on("connect",(function(){r.once("updateEditorOnce",(function(t){i.setState({fp:t,flag:!0})}))})),-1!==i.props.commitIdx&&r.disconnect(),i}return(0,m.Z)(n,[{key:"render",value:function(){return(0,L.jsx)("div",{children:this.state.flag&&(0,L.jsx)(q,{value:this.state.fp,markdownValue:this.props.markdownValue,commitIdx:this.props.commitIdx,userIdx:this.props.userIdx,pdfIdx:this.props.pdfIdx})})}},{key:"componentWillUnmount",value:function(){null!=r&&!0===r.connected&&r.disconnect()}}]),n}(d.Component);function E(t,e,n){i=setTimeout((function(){r.emit("updateEditor",{id:t,pdfId:e,text:n},clearTimeout(i))}),700)}function C(t,e,n){return H.apply(this,arguments)}function H(){return(H=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i?(clearTimeout(i),E(e,n,r)):E(e,n,r);case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function D(t,e){return R.apply(this,arguments)}function R(){return(R=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i,o,s,c;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M(n);case 2:return r=t.sent,i=r.preSignedUrl,o=r.fileName,t.next=7,A(e,o);case 7:return s=t.sent,c="https://label-editor.s3.ap-northeast-2.amazonaws.com/".concat(o),t.next=11,G(i.signedUrlPut,s);case 11:return t.abrupt("return",c);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function M(t){return T.apply(this,arguments)}function T(){return(T=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=Math.random().toString(36).substring(2,11),r="".concat(e,"_").concat(n,".png"),t.next=5,u().post("https://tradingstudy.shop:443/users/sign",{fileName:r});case 5:return i=t.sent,t.abrupt("return",{preSignedUrl:i.data,fileName:r});case 9:t.prev=9,t.t0=t.catch(0),console.log(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))).apply(this,arguments)}function A(t,e){return F.apply(this,arguments)}function F(){return(F=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i,o,s,c;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=e.split(","),i=r[0].match(/:(.*?);/)[1],o=atob(r[1]),s=o.length,c=new Uint8Array(s);s--;)c[s]=o.charCodeAt(s);return t.abrupt("return",new File([c],n,{type:i}));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function G(t,e){return O.apply(this,arguments)}function O(){return(O=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,{method:"PUT",body:n,headers:{"x-amz-acl":"public-read","Content-Type":"image/png"}});case 2:t.sent;case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var q=function(t){var e=t.value,n=t.markdownValue,r=t.commitIdx,i=t.userIdx,o=t.pdfIdx,c=(0,w.jE)((function(t,c){var l=y.ML.make().config((function(c){c.set(y.KP,t),-1===r&&e?c.set(y.Dn,{type:"json",value:e}):-1===r&&0===Object.keys(e).length?c.set(y.Dn,""):(c.set(y.Dn,{type:"json",value:n}),console.log(n)),c.get(_.QC).updated(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(n,r,s){var c,l,u,d,h,g,f,p,m;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c=r.toJSON(),console.log("jsonOutput: ",c),l=c.content,u=0;case 4:if(!(u<l.length)){t.next=31;break}if(!l[u].content){t.next=28;break}d=0;case 7:if(!(d<l[u].content.length)){t.next=28;break}if(h=l[u].content[d],g=h.type,f=h.attrs,console.log("contentAttr",f),void 0===f||f.title){t.next=23;break}return f.title="try",console.log("it is not stored yet!!"),p=f.src,t.next=18,D(p,i);case 18:m=t.sent,console.log("imagesrc:",m),f.src=m,t.next=24;break;case 23:"image"===g&&console.log("it is alread loaded!!");case 24:console.log(l[u],h,g);case 25:d++,t.next=7;break;case 28:u++,t.next=4;break;case 31:return t.next=33,C(i,o,c);case 33:return t.abrupt("return",e);case 34:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}())})).use(S.Ge).use(I.GI).use(N.Qn).use(Z.m8).use(j.r0).use(b.mA).use(k.M).use(_.X3);return l}),[r,n]),l=c.editor;c.loading,c.getInstance;return(0,d.useEffect)((function(){var t,e,n;null===(t=document.querySelector(".ProseMirror.editor"))||void 0===t||t.setAttribute("ondrop","drop_handler(event)"),null===(e=document.querySelector(".ProseMirror.editor"))||void 0===e||e.setAttribute("ondragover","dragover_handler(event)");var i,o,a=null===(n=document.querySelector(".PersonalReading__mainPage"))||void 0===n?void 0:n.clientHeight;null!=a&&(null===(i=document.querySelector(".milkdown"))||void 0===i||i.setAttribute("style","height: ".concat(a-240,"px")));-1!==r&&(null===(o=document.querySelector(".ProseMirror.editor"))||void 0===o||o.setAttribute("contenteditable","false"))})),(0,L.jsx)(w.F3,{editor:l})};var U=function(t){return(0,L.jsx)("div",{dangerouslySetInnerHTML:{__html:t.html}})},Y="HighlightList_wrap__5AIyL",z="HighlightList_container__aHWyH",V="HighlightList_title__hmW+d",W="HighlightList_highlightInfo__StQzz",K="HighlightList_pageNumber__Moyj3",Q={searchBar:"SearchBar_searchBar__nTkuX",search:"SearchBar_search__rUkCI",searchButton:"SearchBar_searchButton__kyrsF",searchInput:"SearchBar_searchInput__64lOR"},X=n(4483),J=n(3174);var $=function(t){return(0,L.jsxs)("form",{className:Q.searchBar,onSubmit:function(t){!function(t){t.preventDefault()}(t)},children:[(0,L.jsx)("button",{className:Q.searchButton,children:(0,L.jsx)(X.G,{icon:J.Y$T,className:Q.searchIcon})}),(0,L.jsx)("input",{className:Q.searchInput,type:"text",id:"search",onChange:function(e){if(""===e.target.value){var n=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().get("https://inkyuoh.shop/highlights/pdfs/".concat(t.pdfIdx,"/pages/").concat(t.currentPageNumber)).then((function(e){console.log("Search highlight data response:",e),t.setHighlightData(e.data.result)})).catch((function(t){console.log("Search highlight data Fail, error:",t)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();n()}else{var r=function(){var n=(0,s.Z)((0,a.Z)().mark((function n(){return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u().get("https://inkyuoh.shop/pdfs/".concat(t.pdfIdx,"/highlights/search?keyword=").concat(e.target.value)).then((function(e){console.log("Search highlight data response:",e),t.setHighlightData(e.data.result)})).catch((function(t){console.log("Search highlight data Fail, error:",t)}));case 2:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();r()}},placeholder:"\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694."})]})};var tt=n(7621),et=n(9504),nt=n(9585),rt=n(890),it=n(3044),ot=n(5130),at=n(3400);function st(t){var e;function n(){return(n=(0,s.Z)((0,a.Z)().mark((function e(n,r,i,o,c,l){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==n){e.next=3;break}return e.next=3,u().delete("https://inkyuoh.shop/highlights/".concat(r)).then((function(t){console.log("highlight delete response:",t)})).catch((function(t){console.log("highlight delete error:",t)})).then((0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().get("https://inkyuoh.shop/highlights/pdfs/".concat(t.pdfIdx,"/pages/").concat(l)).then((function(t){i(t.data.result),c(!o);for(var e=document.getElementsByClassName("highlight"+r),n=0;n<e.length;n++)!0===e[n].classList.contains("highlightedGreen")&&e[n].classList.remove("highlightedGreen"),!0===e[n].classList.contains("highlightedPurple")&&e[n].classList.remove("highlightedPurple"),!0===e[n].classList.contains("highlightedYellow")&&e[n].classList.remove("highlightedYellow")}));case 2:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return console.log(t),(0,L.jsx)(L.Fragment,{children:null===(e=t.highlightData)||void 0===e?void 0:e.map((function(e,r){return(0,L.jsx)(L.Fragment,{children:(0,L.jsxs)(tt.Z,{sx:{width:"100%",minWidth:275,marginBottom:1},children:[(0,L.jsx)(nt.Z,{sx:{paddingBottom:0},avatar:(0,L.jsx)(it.Z,{sx:{width:10,height:10,bgcolor:0===e.color?"#93E7A2":1===e.color?"#9747FF":2===e.color?"#FFD644":null},"aria-label":"recipe",children:""}),title:(0,L.jsx)("p",{style:{color:"#DDDDDD"}}),action:-1===t.commitIdx?(0,L.jsx)(at.Z,{onClick:function(){!function(t,e,r,i,o,a){n.apply(this,arguments)}(t.commitIdx,e.highlightIdx,t.setHighlightData,t.updateHighlightList,t.setUpdateHighlightList,t.currentPageNumber)},children:(0,L.jsx)(ot.Z,{fontSize:"small"})}):null}),(0,L.jsx)(et.Z,{sx:{paddingTop:"4px"},children:(0,L.jsx)(rt.Z,{sx:{fontSize:14},color:"text.secondary",draggable:"true",onDragStart:function(t){!function(t){t.dataTransfer.setData("text/plain",t.target.innerHTML)}(t)},children:e.data})})]},r)})}))})}var ct=function(t){var e=(0,d.useState)([]),n=(0,c.Z)(e,2),r=n[0],i=n[1];return(0,d.useEffect)((function(){if(-1===t.commitIdx){var e=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().get("https://inkyuoh.shop/highlights/pdfs/".concat(t.pdfIdx,"/pages/").concat(t.currentPageNumber)).then((function(t){i(t.data.result)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}else{var n=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().get("https://inkyuoh.shop/highlights/pages/".concat(t.currentPageNumber,"/commitIdx/").concat(t.commitIdx)).then((function(t){i(t.data.result)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();n()}}),[t.currentPageNumber,t.updateHighlightList,t.commitIdx]),(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{className:V,children:"Highlights"}),(0,L.jsx)($,{pdfIdx:t.pdfIdx,currentPageNumber:t.currentPageNumber,highlightData:r,setHighlightData:i}),(0,L.jsx)("div",{className:W,children:(0,L.jsxs)("p",{className:K,children:["Page ",t.currentPageNumber," / ",t.totalPage]})}),(0,L.jsx)("aside",{className:Y,children:(0,L.jsx)("div",{className:z,children:(0,L.jsx)(st,{commitIdx:t.commitIdx,pdfIdx:t.pdfIdx,highlightData:r,setHighlightData:i,style:{overflow:"scroll"},updateHighlightList:t.updateHighlightList,setUpdateHighlightList:t.setUpdateHighlightList,currentPageNumber:t.currentPageNumber})})})]})},lt=n(1171),ut=n(1034),dt=((0,lt.ZP)((function(t){return(0,L.jsx)(ut.Z,(0,o.Z)({focusVisibleClassName:".Mui-focusVisible",disableRipple:!0},t))}))((function(t){var e=t.theme;return{width:42,height:26,padding:0,"& .MuiSwitch-switchBase":{padding:0,margin:2,transitionDuration:"300ms","&.Mui-checked":{transform:"translateX(16px)",color:"#fff","& + .MuiSwitch-track":{backgroundColor:"dark"===e.palette.mode?"#2ECA45":"#93E8DE",opacity:1,border:0},"&.Mui-disabled + .MuiSwitch-track":{opacity:.5}},"&.Mui-focusVisible .MuiSwitch-thumb":{color:"#33cf4d",border:"6px solid #fff"},"&.Mui-disabled .MuiSwitch-thumb":{color:"light"===e.palette.mode?e.palette.grey[100]:e.palette.grey[600]},"&.Mui-disabled + .MuiSwitch-track":{opacity:"light"===e.palette.mode?.7:.3}},"& .MuiSwitch-thumb":{boxSizing:"border-box",width:22,height:22},"& .MuiSwitch-track":{borderRadius:13,backgroundColor:"light"===e.palette.mode?"#E9E9EA":"#39393D",opacity:1,transition:e.transitions.create(["background-color"],{duration:500})}}})),"SideBar_sideBarContents__KmwNy"),ht="SideBar_bookInfo__+AGC2",gt="SideBar_bookImage__o80DQ",ft="SideBar_bookTitle__4hT75",pt="SideBar_historyContainer__laxyt",mt="SideBar_historyTitle__iYLbi",xt="SideBar_historyInput__3t5Oq",vt="SideBar_historyWrap__Ih9xV",yt="SideBar_historyUnorderedListTag__KWQHM",_t="SideBar_historyMessage__kdmFK",kt="SideBar_historyDate__Vax62",wt="SideBar_sideBarToggleButton__D3HGR",Nt=n(7892),St=n.n(Nt),bt=n(3767),It=n(9525),jt=n(9658);function Zt(t){var e;return(0,L.jsx)(L.Fragment,{children:null===(e=t.commitsInfo)||void 0===e?void 0:e.map((function(e,n){return(0,L.jsx)("ul",{className:yt,onClick:function(){!function(e){t.setCommitIdx(e.commitIdx)}(e)},children:(0,L.jsxs)("li",{children:[(0,L.jsx)("p",{className:_t,children:e.commitMessage}),(0,L.jsx)("p",{className:kt,children:e.createdAt})]})},n)}))})}var Pt=function(t){var e=(0,d.useState)(!1),n=(0,c.Z)(e,2),r=n[0],i=n[1],a=(0,d.useState)([]),s=(0,c.Z)(a,2),l=s[0],h=s[1],g=(0,d.useRef)(),f=St()().format("YYYY-MM-DD HH:mm:ss");(0,d.useEffect)((function(){u().get("https://inkyuoh.shop/commits/users/".concat(58,"/books/").concat(t.currentBookInfo.pdfIdx)).then((function(t){var e,n;console.log(t),h(null===t||void 0===t||null===(e=t.data)||void 0===e||null===(n=e.result)||void 0===n?void 0:n.reverse())})).catch((function(t){console.log(t)}))}),[r]);var p=(0,d.useState)(!1),m=(0,c.Z)(p,2),x=m[0],v=m[1],y=(0,d.useState)(!1),_=(0,c.Z)(y,2),k=_[0],w=_[1],N=function(t,e){"clickaway"!==e&&(v(!1),w(!1))},S=d.forwardRef((function(t,e){return(0,L.jsx)(jt.Z,(0,o.Z)({elevation:6,ref:e,variant:"filled"},t))}));return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:dt,style:!0===r?{}:{display:"none"},children:[(0,L.jsxs)("div",{className:ht,children:[(0,L.jsx)("div",{className:gt,style:{backgroundImage:"url("+"".concat(""+"".concat(t.currentBookInfo.firstPageLink))}}),(0,L.jsx)("p",{className:ft,children:t.currentBookInfo.pdfName})]}),(0,L.jsx)("hr",{style:{width:"100%",marginTop:24,marginBottom:24,marginLeft:16,marginRight:16}}),(0,L.jsxs)("div",{className:pt,children:[(0,L.jsx)("div",{className:mt,children:"Commit"}),(0,L.jsx)("form",{onSubmit:function(e){!function(e){e.preventDefault(),""!==g.current.value?(u().post("https://inkyuoh.shop/commits",{pdfIdx:t.currentBookInfo.pdfIdx,userIdx:58,createdAt:f,commitMessage:g.current.value}).then((function(e){console.log("Commit response:",e),u().get("https://inkyuoh.shop/commits/users/".concat(58,"/books/").concat(t.currentBookInfo.pdfIdx)).then((function(t){var e,n;console.log("Reset commitsInfo response:",t),h(null===t||void 0===t||null===(e=t.data)||void 0===e||null===(n=e.result)||void 0===n?void 0:n.reverse()),v(!0)})).catch((function(t){console.log("Reset commitsInfo Fail, error:",t)}))})).catch((function(t){console.log("Commit Fail, error:",t)})),g.current.value=null):w(!0)}(e)},children:(0,L.jsx)("input",{ref:g,className:xt,placeholder:"\uae30\ub85d\uc744 \ub0a8\uae30\uc138\uc694."})}),(0,L.jsx)("div",{className:vt,children:(0,L.jsx)(Zt,{commitIdx:t.commitIdx,setCommitIdx:t.setCommitIdx,commitsInfo:l})})]}),(0,L.jsxs)(bt.Z,{spacing:2,sx:{width:"100%"},children:[(0,L.jsx)(It.Z,{open:x,autoHideDuration:4500,onClose:N,children:(0,L.jsx)(S,{onClose:N,severity:"success",sx:{width:"100%"},children:"\uc800\uc7a5\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."})}),(0,L.jsx)(It.Z,{open:k,autoHideDuration:4500,onClose:N,children:(0,L.jsx)(S,{onClose:N,severity:"error",sx:{width:"100%"},children:"\uae30\ub85d \ub0b4\uc6a9\uc744 \uc791\uc131\ud574\uc8fc\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4."})})]})]}),(0,L.jsx)(X.G,{icon:!0===r?J.EyR:J.yOZ,className:wt,onClick:function(){i(!r)}})]})},Lt=n(5498),Bt=n.n(Lt),Et=n(5125);function Ct(t,e){e.appendChild(t.extractContents()),t.insertNode(e)}function Ht(t,e){var n,r=t.startLine,i=t.startOffset,o=t.startNode,a=t.endLine,s=t.endOffset,c=t.endNode,l=parseInt(r.slice(1),16),u=parseInt(a.slice(1),16);0===t.color&&(n="highlightedGreen"),1===t.color&&(n="highlightedPurple"),2===t.color&&(n="highlightedYellow");for(var d=l;d<=u;d++){var h=document.getElementsByClassName("y".concat(d.toString(16)))[0],g=document.createRange(),f=document.createElement("span");if(f.classList.add(n),f.classList.add("highlight"+e),l===u)return g.setStart(null===h||void 0===h?void 0:h.childNodes[o],i),g.setEnd(null===h||void 0===h?void 0:h.childNodes[c],s),void Ct(g,f);d===l?(g.setStart(null===h||void 0===h?void 0:h.childNodes[o],i),g.setEnd(null===h||void 0===h?void 0:h.childNodes[h.childNodes.length-1],h.childNodes[h.childNodes.length-1].length)):d===u?(g.setStart(null===h||void 0===h?void 0:h.childNodes[0],0),g.setEnd(null===h||void 0===h?void 0:h.childNodes[c],s)):(g.setStart(null===h||void 0===h?void 0:h.childNodes[0],0),g.setEnd(null===h||void 0===h?void 0:h.childNodes[h.childNodes.length-1],h.childNodes[h.childNodes.length-1].length)),Ct(g,f)}}function Dt(t,e,n,r,i,o){for(var a=window.getSelection().toString().trim(),s=window.getSelection().getRangeAt(0),c=window.getSelection().getRangeAt(0).startContainer,l=window.getSelection().getRangeAt(0).endContainer,d=c.parentElement,h=l.parentElement,g=s.startOffset,f=0,p=0;p<d.childNodes.length;p++)d.childNodes[p]===c&&(f=p);for(var m=s.endOffset,x=0,v=0;v<h.childNodes.length;v++)h.childNodes[v]===l&&(x=v);function y(t,e){return!0===t.classList.toString().includes("y")?t.classList:y(t.parentElement,e+1)}var _,k=y(d,0)[4],w=y(h,0)[4];"highlightedGreen"===o&&(_=0),"highlightedPurple"===o&&(_=1),"highlightedYellow"===o&&(_=2);var N={pdfIdx:t,pageNum:e,startLine:k,startOffset:g,startNode:f,endLine:w,endOffset:m,endNode:x,data:a,color:_};u().post("https://inkyuoh.shop/highlights",{pdfIdx:t,pageNum:e,startLine:k,startOffset:g,startNode:f,endLine:w,endOffset:m,endNode:x,data:a,color:_}).then((function(t){console.log("Highlight POST Success\nresponse:",t),i(!r)})).catch((function(t){console.log("Highlight POST Fail\nerror:",t)})).then((function(){u().get("https://inkyuoh.shop/highlights/pdfs/".concat(t,"/pages/").concat(e)).then((function(t){Ht(N,t.data.result[t.data.result.length-1].highlightIdx)}))})),n.current.style.display="none"}function Rt(t,e,n,r){if("back"===t){if(1===e)return;n((function(t){return t-1}))}if("go"===t){if(e===r)return;n((function(t){return t+1}))}}var Mt=function(t){var e=(0,h.TH)().state,n=e.pdfIdx,r=e.recentlyReadPage,i=(0,d.useState)(""),l=(0,c.Z)(i,2),g=l[0],p=l[1],m=(0,d.useState)(!0),x=(0,c.Z)(m,2),v=x[0],y=x[1],_=(0,d.useState)(-1),k=(0,c.Z)(_,2),w=k[0],N=k[1],S=(0,d.useState)({}),b=(0,c.Z)(S,2),I=b[0],j=b[1],Z=(0,d.useState)([]),P=(0,c.Z)(Z,2),E=P[0],C=P[1],H=(0,d.useRef)(),D=(0,d.useRef)(),R=(0,d.useRef)(),M=(0,d.useRef)(),T=(0,d.useState)(r),A=(0,c.Z)(T,2),F=A[0],G=A[1],O=(0,d.useState)({}),q=(0,c.Z)(O,2),Y=q[0],z=q[1];return(0,d.useEffect)((function(){u().get("https://inkyuoh.shop/users/".concat(58,"/pdfs")).then((function(t){console.log("TotalPage GET response:",t);var e=t.data.result.find((function(t){return t.pdfIdx===n}));z(e)})).catch((function(t){console.log("TotalPage GET Fail, error:",t)}))}),[n]),(0,d.useEffect)((function(){if(-1===w){var t=function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u().get("https://inkyuoh.shop/pdfs/".concat(n,"/pages/").concat(F)).then((function(t){return t.data.result.pageLink}));case 2:return e=t.sent,t.next=5,u().get("".concat(e)).then((function(t){p(t.data)}));case 5:return t.sent,t.next=8,u().get("https://inkyuoh.shop/highlights/pdfs/".concat(n,"/pages/").concat(F)).then((function(t){C(t.data.result)}));case 8:t.sent;case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}else{var e=function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u().get("https://inkyuoh.shop/pdfs/".concat(n,"/pages/").concat(F)).then((function(t){return t.data.result.pageLink}));case 2:return e=t.sent,t.next=5,u().get("".concat(e)).then((function(t){p(t.data)}));case 5:return t.sent,t.next=8,u().get("https://inkyuoh.shop/highlights/pages/".concat(F,"/commitIdx/").concat(w)).then((function(t){C(t.data.result)}));case 8:t.sent;case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();e()}}),[F,t.mode,w]),(0,d.useEffect)((function(){function t(t){var e=H.current;setTimeout((function(){if(0!=window.getSelection().toString().trim()){var n=t.pageX,r=t.pageY,i=Number(getComputedStyle(e).width.slice(0,-2)),o=Number(getComputedStyle(e).width.slice(0,-2));e.style.left="".concat(n-.5*i,"px"),e.style.top="".concat(r-1*o,"px"),e.style.display="flex",e.classList.add("btnEntrance")}}),0)}var e=document.querySelectorAll(".PersonalReading__mainPage--readingPage");function n(t){var e=H.current;"flex"===e.style.display&&!1===t.target.classList.contains("specific")&&(e.style.display="none",e.classList.remove("btnEntrance"),window.getSelection().empty())}return null===e||void 0===e||e.forEach((function(e){null===e||void 0===e||e.addEventListener("mouseup",t),null===e||void 0===e||e.addEventListener("touchend",t,!1)})),document.addEventListener("mousedown",n),document.addEventListener("touchstart",n,!1),function(){null===e||void 0===e||e.forEach((function(e){null===e||void 0===e||e.removeEventListener("mouseup",t),null===e||void 0===e||e.removeEventListener("touchend",t)})),document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}}),[g]),(0,d.useEffect)((function(){p((0,o.Z)({},g)),-1!==w&&u().post("https://inkyuoh.shop/commits/books/2/2",{commitIdx:w}).then((function(t){return JSON.parse(t.data.result[0].editorLog)})).then((function(t){console.log(t),j(t)}))}),[w]),(0,d.useEffect)((function(){try{for(var t=0;t<E.length;t++)Ht(E[t],E[t].highlightIdx)}catch(e){}}),[E,w]),(0,d.useEffect)((function(){document.querySelectorAll(".c").forEach((function(t){t.style.height="110%"})),document.querySelectorAll(".t").forEach((function(t){t.style.height="2.1em"}))}),[g]),(0,d.useEffect)((function(){return f()(".HighlightButton").on("touchstart",(function(){Dt(n,F,H,v,y,"highlightedGreen")})),f()(".HighlightButton__purple").on("touchstart",(function(){Dt(n,F,H,v,y,"highlightedPurple")})),f()(".HighlightButton__yellow").on("touchstart",(function(){Dt(n,F,H,v,y,"highlightedYellow")})),function(){f()(".HighlightButton").off("touchstart",(function(){Dt(n,F,H,v,y,"highlightedGreen")})),f()(".HighlightButton__purple").off("touchstart",(function(){Dt(n,F,H,v,y,"highlightedPurple")})),f()(".HighlightButton__yellow").off("touchstart",(function(){Dt(n,F,H,v,y,"highlightedYellow")}))}}),[g]),(0,L.jsxs)("main",{className:"PersonalReading",children:[(0,L.jsxs)("div",{ref:H,className:"HighlightButton__wrap",children:[(0,L.jsx)("button",{ref:D,className:"HighlightButton specific",onClick:function(){Dt(n,F,H,v,y,"highlightedGreen")}}),(0,L.jsx)("button",{ref:R,className:"HighlightButton__purple specific",onClick:function(){Dt(n,F,H,v,y,"highlightedPurple")}}),(0,L.jsx)("button",{ref:M,className:"HighlightButton__yellow specific",onClick:function(){Dt(n,F,H,v,y,"highlightedYellow")}})]}),(0,L.jsxs)("div",{className:"PersonalReading__container",children:[(0,L.jsx)("aside",{className:"PersonalReading__sideBar",children:(0,L.jsx)(Pt,{commitIdx:w,setCommitIdx:N,currentBookInfo:Y})}),(0,L.jsxs)("div",{className:"PersonalReading__mainPage",style:!0===t.mode?{flex:3}:{flex:1},children:[!0===t.mode?(0,L.jsxs)("article",{className:"PersonalReading__mainPage--readingPage",style:!0===t.mode?{flex:2}:{flex:0},children:[(0,L.jsx)(U,{className:"PageRendered",html:g}),(0,L.jsxs)("div",{className:"PersonalReading__mainPage--goBackButtons",children:[(0,L.jsx)(X.G,{icon:J.Uu6,className:"backButton",onClick:function(){Rt("back",F,G,Y.totalPage)},onTouchStart:function(){Rt("back",F,G,Y.totalPage)}}),(0,L.jsx)(X.G,{icon:J.I4f,className:"goButton",onClick:function(){Rt("go",F,G,Y.totalPage)},onTouchStart:function(){Rt("go",F,G,Y.totalPage)}})]}),(0,L.jsx)("div",{className:"PersonalReading__mainPage--info",children:(0,L.jsxs)("p",{children:[(0,L.jsx)("input",{className:"PersonalReading__mainPage--info--input",placeholder:F,onKeyUp:function(t){t.preventDefault(),13===window.event.keyCode&&1<=t.target.value&&t.target.value<=Y.totalPage&&(G(Number(t.target.value)),t.target.value=null)}})," / ",Y.totalPage]})})]}):null,(0,L.jsx)("aside",{className:"PersonalReading__highlightList",style:(t.mode,{flex:1}),children:(0,L.jsx)(ct,{commitIdx:w,setCommitIdx:N,pdfIdx:n,totalPage:Y.totalPage,currentPageNumber:F,updateHighlightList:v,setUpdateHighlightList:y})})]}),(0,L.jsxs)("article",{className:"PersonalReading__mainPage--textEditor",style:(t.mode,{flex:1}),children:[(0,L.jsxs)("div",{className:"PersonalReading__mainPage--textEditor--wrap",children:[(0,L.jsxs)("div",{className:"PersonalReading__mainPage--textEditor--info",children:[(0,L.jsx)("p",{style:{fontSize:"16px"},children:Y.pdfName}),(0,L.jsx)("p",{style:{fontSize:"12px",textDecoration:"underline"},children:"5\ubd84 \uc804\uc5d0 \uc218\uc815\ud558\uc600\uc2b5\ub2c8\ub2e4."})]}),(0,L.jsx)(X.G,{className:"ToPdfButton",icon:J.gSj,onClick:function(){setTimeout((function(){!function(t){var e,n,r,i;null===(e=document.querySelector(".editor"))||void 0===e||e.setAttribute("style","overflow: visible !important"),null===(n=document.querySelector(".editor"))||void 0===n||n.setAttribute("style","height: auto !important");var o=new Array,a=15;function s(t,e,n,r){var i=.2645*f()(r).outerWidth(),a=.2645*f()(r).outerHeight()*180/i;Bt()(r).then((function(e){var r=e.toDataURL("image/jpeg",1);o.push({num:t,image:r,height:a}),n.resolve()}))}!function(){var e=document.querySelectorAll(".editor > *");console.log(e);for(var n=[],r=new Et.ZP("p","mm","a4"),i=0;i<e.length;i++){var c=f().Deferred();n.push(c.promise()),s(i,r,c,e[i])}f().when.apply(f(),n).then((function(){for(var e=o.sort((function(t,e){return t.num<e.num?-1:1})),n=a,i=0;i<e.length;i++){var s=e[i].height,c=e[i].image;n+s>267?(r.addPage(),n=a,r.addImage(c,"jpeg",a,n,180,s),n+=s):(r.addImage(c,"jpeg",a,n,180,s),n+=s)}r.save("".concat(t,".pdf")),n=a,o=new Array}))}(),null===(r=document.querySelector(".editor"))||void 0===r||r.setAttribute("style","overflow: scroll !important"),null===(i=document.querySelector(".editor"))||void 0===i||i.setAttribute("style","height: 100% !important")}(Y.pdfName)}),100)}})]}),(0,L.jsx)(B,{markdownValue:I,commitIdx:w,userIdx:String(58),pdfIdx:String(n)})]})]})]})}}}]);
//# sourceMappingURL=891.a50f11ce.chunk.js.map