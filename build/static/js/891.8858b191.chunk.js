"use strict";(self.webpackChunklabel_front=self.webpackChunklabel_front||[]).push([[891],{8891:function(e,t,n){n.r(t),n.d(t,{default:function(){return De}});var r,i,o=n(1413),a=n(4165),s=n(5861),c=n(9439),l=n(4569),u=n.n(l),d=n(2791),h=n(6871),g=n(8890),f=n.n(g),p=n(5671),m=n(3144),x=n(136),v=n(9388),y=n(9407),_=n(548),k=n(5712),w=n(641),N=n(5141),S=n(6983),I=n(3126),b=n(381),j=n(6337),Z=n(8789),P=n(4428),L=n(184),E=function(e){(0,x.Z)(n,e);var t=(0,v.Z)(n);function n(e){var i;return(0,p.Z)(this,n),i=t.call(this,e),r=(0,P.ZP)("https://tradingstudy.shop:443",{transports:["websocket"],query:{userId:String(i.props.userIdx),pdfId:String(i.props.pdfIdx)}}),i.state={fp:{},flag:!1},r.on("connect",(function(){r.once("updateEditorOnce",(function(e){i.setState({fp:e,flag:!0})}))})),-1!==i.props.commitIdx&&r.disconnect(),i}return(0,m.Z)(n,[{key:"render",value:function(){return(0,L.jsx)("div",{children:this.state.flag&&(0,L.jsx)(q,{value:this.state.fp,markdownValue:this.props.markdownValue,commitIdx:this.props.commitIdx,userIdx:this.props.userIdx,pdfIdx:this.props.pdfIdx})})}},{key:"componentWillUnmount",value:function(){null!=r&&!0===r.connected&&r.disconnect()}}]),n}(d.Component);function B(e,t,n){i=setTimeout((function(){r.emit("updateEditor",{id:e,pdfId:t,text:n},clearTimeout(i))}),700)}function C(e,t,n){return H.apply(this,arguments)}function H(){return(H=(0,s.Z)((0,a.Z)().mark((function e(t,n,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i?(clearTimeout(i),B(t,n,r)):B(t,n,r);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t){return D.apply(this,arguments)}function D(){return(D=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T(n);case 2:return r=e.sent,i=r.preSignedUrl,o=r.fileName,e.next=7,M(t,o);case 7:return s=e.sent,c="https://label-editor.s3.ap-northeast-2.amazonaws.com/".concat(o),e.next=11,O(i.signedUrlPut,s);case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return A.apply(this,arguments)}function A(){return(A=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=Math.random().toString(36).substring(2,11),r="".concat(t,"_").concat(n,".png"),e.next=5,u().post("https://tradingstudy.shop:443/users/sign",{fileName:r});case 5:return i=e.sent,e.abrupt("return",{preSignedUrl:i.data,fileName:r});case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function M(e,t){return F.apply(this,arguments)}function F(){return(F=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=t.split(","),i=r[0].match(/:(.*?);/)[1],o=atob(r[1]),s=o.length,c=new Uint8Array(s);s--;)c[s]=o.charCodeAt(s);return e.abrupt("return",new File([c],n,{type:i}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t){return G.apply(this,arguments)}function G(){return(G=(0,s.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"PUT",body:n,headers:{"x-amz-acl":"public-read","Content-Type":"image/png"}});case 2:e.sent;case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var q=function(e){var t=e.value,n=e.markdownValue,r=e.commitIdx,i=e.userIdx,o=e.pdfIdx,c=(0,w.jE)((function(e,c){var l=y.ML.make().config((function(c){c.set(y.KP,e),-1===r&&t?c.set(y.Dn,{type:"json",value:t}):-1===r&&0===Object.keys(t).length?c.set(y.Dn,""):(c.set(y.Dn,{type:"json",value:n}),console.log(n)),c.get(_.QC).updated(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(n,r,s){var c,l,u,d,h,g,f,p,m;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=r.toJSON(),console.log("jsonOutput: ",c),l=c.content,u=0;case 4:if(!(u<l.length)){e.next=31;break}if(!l[u].content){e.next=28;break}d=0;case 7:if(!(d<l[u].content.length)){e.next=28;break}if(h=l[u].content[d],g=h.type,f=h.attrs,console.log("contentAttr",f),void 0===f||f.title){e.next=23;break}return f.title="try",console.log("it is not stored yet!!"),p=f.src,e.next=18,R(p,i);case 18:m=e.sent,console.log("imagesrc:",m),f.src=m,e.next=24;break;case 23:"image"===g&&console.log("it is alread loaded!!");case 24:console.log(l[u],h,g);case 25:d++,e.next=7;break;case 28:u++,e.next=4;break;case 31:return e.next=33,C(i,o,c);case 33:return e.abrupt("return",t);case 34:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}())})).use(S.Ge).use(b.GI).use(N.Qn).use(Z.m8).use(j.r0).use(I.mA).use(k.M).use(_.X3);return l}),[r,n]),l=c.editor;c.loading,c.getInstance;return(0,d.useEffect)((function(){var e,t,n;null===(e=document.querySelector(".ProseMirror.editor"))||void 0===e||e.setAttribute("ondrop","drop_handler(event)"),null===(t=document.querySelector(".ProseMirror.editor"))||void 0===t||t.setAttribute("ondragover","dragover_handler(event)");var i,o,a=null===(n=document.querySelector(".PersonalReading__mainPage"))||void 0===n?void 0:n.clientHeight;null!=a&&(null===(i=document.querySelector(".milkdown"))||void 0===i||i.setAttribute("style","height: ".concat(a-240,"px")));-1!==r&&(null===(o=document.querySelector(".ProseMirror.editor"))||void 0===o||o.setAttribute("contenteditable","false"))})),(0,L.jsx)(w.F3,{editor:l})};var U=function(e){return(0,L.jsx)("div",{dangerouslySetInnerHTML:{__html:e.html}})},Y="HighlightList_wrap__5AIyL",V="HighlightList_container__aHWyH",z="HighlightList_title__hmW+d",W="HighlightList_highlightInfo__StQzz",K={searchBar:"SearchBar_searchBar__nTkuX",search:"SearchBar_search__rUkCI",searchButton:"SearchBar_searchButton__kyrsF",searchInput:"SearchBar_searchInput__64lOR"},Q=n(4483),X=n(3174);var J=function(e){return(0,L.jsxs)("form",{className:K.searchBar,onSubmit:function(e){!function(e){e.preventDefault()}(e)},children:[(0,L.jsx)("button",{className:K.searchButton,children:(0,L.jsx)(Q.G,{icon:X.Y$T,className:K.searchIcon})}),(0,L.jsx)("input",{className:K.searchInput,type:"text",id:"search",onChange:function(t){if(""===t.target.value){var n=function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u().get("https://inkyuoh.shop/highlights/pdfs/".concat(e.pdfIdx,"/pages/").concat(e.currentPageNumber)).then((function(t){console.log("Search highlight data response:",t),e.setHighlightData(t.data.result)})).catch((function(e){console.log("Search highlight data Fail, error:",e)}));case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();n()}else{var r=function(){var n=(0,s.Z)((0,a.Z)().mark((function n(){return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u().get("https://inkyuoh.shop/pdfs/".concat(e.pdfIdx,"/highlights/search?keyword=").concat(t.target.value)).then((function(t){console.log("Search highlight data response:",t),e.setHighlightData(t.data.result.sort((function(e,t){return e.pageNum-t.pageNum})))})).catch((function(e){console.log("Search highlight data Fail, error:",e)}));case 2:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();r()}},placeholder:"\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694."})]})};var $=n(7621),ee=n(9504),te=n(9585),ne=n(890),re=n(3044),ie=n(5130),oe=n(3400);function ae(e){var t;function n(){return(n=(0,s.Z)((0,a.Z)().mark((function t(n,r,i,o,c,l){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(-1!==n){t.next=3;break}return t.next=3,u().delete("https://inkyuoh.shop/highlights/".concat(r)).then((function(e){console.log("highlight delete response:",e)})).catch((function(e){console.log("highlight delete error:",e)})).then((0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u().get("https://inkyuoh.shop/highlights/pdfs/".concat(e.pdfIdx,"/pages/").concat(l)).then((function(e){i(e.data.result),c(!o);for(var t=document.getElementsByClassName("highlight"+r),n=0;n<t.length;n++)!0===t[n].classList.contains("highlightedGreen")&&t[n].classList.remove("highlightedGreen"),!0===t[n].classList.contains("highlightedPurple")&&t[n].classList.remove("highlightedPurple"),!0===t[n].classList.contains("highlightedYellow")&&t[n].classList.remove("highlightedYellow")}));case 2:case"end":return t.stop()}}),t)}))));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return console.log(e.highlightData),(0,L.jsx)(L.Fragment,{children:null===(t=e.highlightData)||void 0===t?void 0:t.map((function(t,r){return(0,L.jsx)(L.Fragment,{children:(0,L.jsxs)($.Z,{sx:{width:"100%",minWidth:275,marginBottom:1},children:[(0,L.jsx)(te.Z,{sx:{paddingBottom:0},avatar:(0,L.jsx)(re.Z,{sx:{width:10,height:10,bgcolor:0===t.color?"#93E7A2":1===t.color?"#9747FF":2===t.color?"#FFD644":null},"aria-label":"recipe",children:""}),title:"p."+"".concat(t.pageNum),action:-1===e.commitIdx?(0,L.jsx)(oe.Z,{onClick:function(){!function(e,t,r,i,o,a){n.apply(this,arguments)}(e.commitIdx,t.highlightIdx,e.setHighlightData,e.updateHighlightList,e.setUpdateHighlightList,e.currentPageNumber)},children:(0,L.jsx)(ie.Z,{fontSize:"small"})}):null}),(0,L.jsx)(ee.Z,{sx:{paddingTop:"4px"},children:(0,L.jsx)(ne.Z,{sx:{fontSize:14},color:"text.secondary",draggable:"true",onDragStart:function(e){!function(e){e.dataTransfer.setData("text/plain",e.target.innerHTML)}(e)},children:t.data})})]},r)})}))})}var se=function(e){var t=(0,d.useState)([]),n=(0,c.Z)(t,2),r=n[0],i=n[1];return(0,d.useEffect)((function(){if(-1===e.commitIdx){var t=function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u().get("https://inkyuoh.shop/highlights/pdfs/".concat(e.pdfIdx,"/pages/").concat(e.currentPageNumber)).then((function(e){i(e.data.result)}));case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}else{var n=function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u().get("https://inkyuoh.shop/highlights/pages/".concat(e.currentPageNumber,"/commitIdx/").concat(e.commitIdx)).then((function(e){i(e.data.result)}));case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();n()}}),[e.currentPageNumber,e.updateHighlightList,e.commitIdx]),(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{className:z,children:"Highlights"}),(0,L.jsx)(J,{pdfIdx:e.pdfIdx,currentPageNumber:e.currentPageNumber,highlightData:r,setHighlightData:i}),(0,L.jsx)("div",{className:W}),(0,L.jsx)("aside",{className:Y,children:(0,L.jsx)("div",{className:V,children:(0,L.jsx)(ae,{commitIdx:e.commitIdx,pdfIdx:e.pdfIdx,highlightData:r,setHighlightData:i,style:{overflow:"scroll"},updateHighlightList:e.updateHighlightList,setUpdateHighlightList:e.setUpdateHighlightList,currentPageNumber:e.currentPageNumber})})})]})},ce=n(1171),le=n(1034),ue=((0,ce.ZP)((function(e){return(0,L.jsx)(le.Z,(0,o.Z)({focusVisibleClassName:".Mui-focusVisible",disableRipple:!0},e))}))((function(e){var t=e.theme;return{width:42,height:26,padding:0,"& .MuiSwitch-switchBase":{padding:0,margin:2,transitionDuration:"300ms","&.Mui-checked":{transform:"translateX(16px)",color:"#fff","& + .MuiSwitch-track":{backgroundColor:"dark"===t.palette.mode?"#2ECA45":"#93E8DE",opacity:1,border:0},"&.Mui-disabled + .MuiSwitch-track":{opacity:.5}},"&.Mui-focusVisible .MuiSwitch-thumb":{color:"#33cf4d",border:"6px solid #fff"},"&.Mui-disabled .MuiSwitch-thumb":{color:"light"===t.palette.mode?t.palette.grey[100]:t.palette.grey[600]},"&.Mui-disabled + .MuiSwitch-track":{opacity:"light"===t.palette.mode?.7:.3}},"& .MuiSwitch-thumb":{boxSizing:"border-box",width:22,height:22},"& .MuiSwitch-track":{borderRadius:13,backgroundColor:"light"===t.palette.mode?"#E9E9EA":"#39393D",opacity:1,transition:t.transitions.create(["background-color"],{duration:500})}}})),"SideBar_sideBarContents__KmwNy"),de="SideBar_bookInfo__+AGC2",he="SideBar_bookImage__o80DQ",ge="SideBar_bookTitle__4hT75",fe="SideBar_historyContainer__laxyt",pe="SideBar_historyTitle__iYLbi",me="SideBar_historyInput__3t5Oq",xe="SideBar_historyWrap__Ih9xV",ve="SideBar_historyUnorderedListTag__KWQHM",ye="SideBar_historyMessage__kdmFK",_e="SideBar_historyDate__Vax62",ke="SideBar_sideBarToggleButton__D3HGR",we=n(7892),Ne=n.n(we),Se=n(3767),Ie=n(9525),be=n(9658);function je(e){var t;return(0,L.jsx)(L.Fragment,{children:null===(t=e.commitsInfo)||void 0===t?void 0:t.map((function(t,n){return(0,L.jsx)("ul",{className:ve,onClick:function(){!function(t){e.setCommitIdx(t.commitIdx)}(t)},children:(0,L.jsxs)("li",{children:[(0,L.jsx)("p",{className:ye,children:t.commitMessage}),(0,L.jsx)("p",{className:_e,children:t.createdAt})]})},n)}))})}var Ze=function(e){var t=(0,d.useState)(!1),n=(0,c.Z)(t,2),r=n[0],i=n[1],a=(0,d.useState)([]),s=(0,c.Z)(a,2),l=s[0],h=s[1],g=(0,d.useRef)(),f=Ne()().format("YYYY-MM-DD HH:mm:ss");(0,d.useEffect)((function(){u().get("https://inkyuoh.shop/commits/users/".concat(58,"/books/").concat(e.currentBookInfo.pdfIdx)).then((function(e){var t,n;console.log(e),h(null===e||void 0===e||null===(t=e.data)||void 0===t||null===(n=t.result)||void 0===n?void 0:n.reverse())})).catch((function(e){console.log(e)}))}),[r]);var p=(0,d.useState)(!1),m=(0,c.Z)(p,2),x=m[0],v=m[1],y=(0,d.useState)(!1),_=(0,c.Z)(y,2),k=_[0],w=_[1],N=function(e,t){"clickaway"!==t&&(v(!1),w(!1))},S=d.forwardRef((function(e,t){return(0,L.jsx)(be.Z,(0,o.Z)({elevation:6,ref:t,variant:"filled"},e))}));return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:ue,style:!0===r?{}:{display:"none"},children:[(0,L.jsxs)("div",{className:de,children:[(0,L.jsx)("div",{className:he,style:{backgroundImage:"url("+"".concat(""+"".concat(e.currentBookInfo.firstPageLink))}}),(0,L.jsx)("p",{className:ge,children:e.currentBookInfo.pdfName})]}),(0,L.jsx)("hr",{style:{width:"100%",marginTop:24,marginBottom:24,marginLeft:16,marginRight:16}}),(0,L.jsxs)("div",{className:fe,children:[(0,L.jsx)("div",{className:pe,children:"History"}),(0,L.jsx)("form",{onSubmit:function(t){!function(t){t.preventDefault(),""!==g.current.value?(u().post("https://inkyuoh.shop/commits",{pdfIdx:e.currentBookInfo.pdfIdx,userIdx:58,createdAt:f,commitMessage:g.current.value}).then((function(t){console.log("Commit response:",t),u().get("https://inkyuoh.shop/commits/users/".concat(58,"/books/").concat(e.currentBookInfo.pdfIdx)).then((function(e){var t,n;console.log("Reset commitsInfo response:",e),h(null===e||void 0===e||null===(t=e.data)||void 0===t||null===(n=t.result)||void 0===n?void 0:n.reverse()),v(!0)})).catch((function(e){console.log("Reset commitsInfo Fail, error:",e)}))})).catch((function(e){console.log("Commit Fail, error:",e)})),g.current.value=null):w(!0)}(t)},children:(0,L.jsx)("input",{ref:g,className:me,placeholder:"\uae30\ub85d\uc744 \ub0a8\uae30\uc138\uc694."})}),(0,L.jsx)("div",{className:xe,children:(0,L.jsx)(je,{commitIdx:e.commitIdx,setCommitIdx:e.setCommitIdx,commitsInfo:l})})]}),(0,L.jsxs)(Se.Z,{spacing:2,sx:{width:"100%"},children:[(0,L.jsx)(Ie.Z,{open:x,autoHideDuration:4500,onClose:N,children:(0,L.jsx)(S,{onClose:N,severity:"success",sx:{width:"100%"},children:"\uc800\uc7a5\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."})}),(0,L.jsx)(Ie.Z,{open:k,autoHideDuration:4500,onClose:N,children:(0,L.jsx)(S,{onClose:N,severity:"error",sx:{width:"100%"},children:"\uae30\ub85d \ub0b4\uc6a9\uc744 \uc791\uc131\ud574\uc8fc\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4."})})]})]}),(0,L.jsx)(Q.G,{icon:!0===r?X.EyR:X.yOZ,className:ke,onClick:function(){i(!r)}})]})},Pe=n(5498),Le=n.n(Pe),Ee=n(5125);function Be(e,t){t.appendChild(e.extractContents()),e.insertNode(t)}function Ce(e,t){var n,r=e.startLine,i=e.startOffset,o=e.startNode,a=e.endLine,s=e.endOffset,c=e.endNode,l=parseInt(r.slice(1),16),u=parseInt(a.slice(1),16);0===e.color&&(n="highlightedGreen"),1===e.color&&(n="highlightedPurple"),2===e.color&&(n="highlightedYellow");for(var d=l;d<=u;d++){var h=document.getElementsByClassName("y".concat(d.toString(16)))[0],g=document.createRange(),f=document.createElement("span");if(f.classList.add(n),f.classList.add("highlight"+t),l===u)return g.setStart(null===h||void 0===h?void 0:h.childNodes[o],i),g.setEnd(null===h||void 0===h?void 0:h.childNodes[c],s),void Be(g,f);d===l?(g.setStart(null===h||void 0===h?void 0:h.childNodes[o],i),g.setEnd(null===h||void 0===h?void 0:h.childNodes[h.childNodes.length-1],h.childNodes[h.childNodes.length-1].length)):d===u?(g.setStart(null===h||void 0===h?void 0:h.childNodes[0],0),g.setEnd(null===h||void 0===h?void 0:h.childNodes[c],s)):(g.setStart(null===h||void 0===h?void 0:h.childNodes[0],0),g.setEnd(null===h||void 0===h?void 0:h.childNodes[h.childNodes.length-1],h.childNodes[h.childNodes.length-1].length)),Be(g,f)}}function He(e,t,n,r,i,o,a){null===a||void 0===a||a.stopPropagation();for(var s=window.getSelection().toString().trim(),c=window.getSelection().getRangeAt(0),l=window.getSelection().getRangeAt(0).startContainer,d=window.getSelection().getRangeAt(0).endContainer,h=l.parentElement,g=d.parentElement,f=c.startOffset,p=0,m=0;m<h.childNodes.length;m++)h.childNodes[m]===l&&(p=m);for(var x=c.endOffset,v=0,y=0;y<g.childNodes.length;y++)g.childNodes[y]===d&&(v=y);function _(e,t){return!0===e.classList.toString().includes("y")?e.classList:_(e.parentElement,t+1)}var k,w=_(h,0)[4],N=_(g,0)[4];"highlightedGreen"===o&&(k=0),"highlightedPurple"===o&&(k=1),"highlightedYellow"===o&&(k=2);var S={pdfIdx:e,pageNum:t,startLine:w,startOffset:f,startNode:p,endLine:N,endOffset:x,endNode:v,data:s,color:k};u().post("https://inkyuoh.shop/highlights",{pdfIdx:e,pageNum:t,startLine:w,startOffset:f,startNode:p,endLine:N,endOffset:x,endNode:v,data:s,color:k}).then((function(e){console.log("Highlight POST Success\nresponse:",e),i(!r)})).catch((function(e){console.log("Highlight POST Fail\nerror:",e)})).then((function(){u().get("https://inkyuoh.shop/highlights/pdfs/".concat(e,"/pages/").concat(t)).then((function(e){Ce(S,e.data.result[e.data.result.length-1].highlightIdx)}))})),n.current.style.display="none"}function Re(e,t,n,r){if("back"===e){if(1===t)return;n((function(e){return e-1}))}if("go"===e){if(t===r)return;n((function(e){return e+1}))}}var De=function(e){var t=(0,h.TH)().state,n=t.pdfIdx,r=t.recentlyReadPage,i=(0,d.useState)(""),l=(0,c.Z)(i,2),g=l[0],p=l[1],m=(0,d.useState)(!0),x=(0,c.Z)(m,2),v=x[0],y=x[1],_=(0,d.useState)(-1),k=(0,c.Z)(_,2),w=k[0],N=k[1],S=(0,d.useState)({}),I=(0,c.Z)(S,2),b=I[0],j=I[1],Z=(0,d.useState)([]),P=(0,c.Z)(Z,2),B=P[0],C=P[1],H=(0,d.useRef)(),R=(0,d.useRef)(),D=(0,d.useRef)(),T=(0,d.useRef)(),A=(0,d.useState)(r),M=(0,c.Z)(A,2),F=M[0],O=M[1],G=(0,d.useState)({}),q=(0,c.Z)(G,2),Y=q[0],V=q[1];return(0,d.useEffect)((function(){u().get("https://inkyuoh.shop/users/".concat(58,"/pdfs")).then((function(e){console.log("TotalPage GET response:",e);var t=e.data.result.find((function(e){return e.pdfIdx===n}));V(t)})).catch((function(e){console.log("TotalPage GET Fail, error:",e)}))}),[n]),(0,d.useEffect)((function(){if(-1===w){var e=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().get("https://inkyuoh.shop/pdfs/".concat(n,"/pages/").concat(F)).then((function(e){return e.data.result.pageLink}));case 2:return t=e.sent,e.next=5,u().get("".concat(t)).then((function(e){p(e.data)}));case 5:return e.sent,e.next=8,u().get("https://inkyuoh.shop/highlights/pdfs/".concat(n,"/pages/").concat(F)).then((function(e){C(e.data.result)}));case 8:e.sent;case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}else{var t=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().get("https://inkyuoh.shop/pdfs/".concat(n,"/pages/").concat(F)).then((function(e){return e.data.result.pageLink}));case 2:return t=e.sent,e.next=5,u().get("".concat(t)).then((function(e){p(e.data)}));case 5:return e.sent,e.next=8,u().get("https://inkyuoh.shop/highlights/pages/".concat(F,"/commitIdx/").concat(w)).then((function(e){C(e.data.result)}));case 8:e.sent;case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t()}}),[F,e.mode,w]),(0,d.useEffect)((function(){function e(e){var t=H.current;setTimeout((function(){if(0!=window.getSelection().toString().trim()){var n=e.pageX,r=e.pageY,i=Number(getComputedStyle(t).width.slice(0,-2)),o=Number(getComputedStyle(t).width.slice(0,-2));t.style.left="".concat(n-.5*i,"px"),t.style.top="".concat(r-1*o,"px"),t.style.display="flex",t.classList.add("btnEntrance")}}),0)}var t=document.querySelectorAll(".PersonalReading__mainPage--readingPage");function n(e){var t=H.current;"flex"===t.style.display&&!1===e.target.classList.contains("specific")&&(t.style.display="none",t.classList.remove("btnEntrance"),window.getSelection().empty())}return null===t||void 0===t||t.forEach((function(t){null===t||void 0===t||t.addEventListener("mouseup",e),null===t||void 0===t||t.addEventListener("touchend",e,!1)})),document.addEventListener("mousedown",n),document.addEventListener("touchstart",n,!1),document.querySelectorAll(".c").forEach((function(e){e.style.height="110%"})),document.querySelectorAll(".t").forEach((function(e){e.style.height="2.1em"})),function(){null===t||void 0===t||t.forEach((function(t){null===t||void 0===t||t.removeEventListener("mouseup",e),null===t||void 0===t||t.removeEventListener("touchend",e)})),document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}}),[g]),(0,d.useEffect)((function(){p((0,o.Z)({},g)),-1!==w&&u().post("https://inkyuoh.shop/commits/books/2/2",{commitIdx:w}).then((function(e){return JSON.parse(e.data.result[0].editorLog)})).then((function(e){console.log(e),j(e)}))}),[w]),(0,d.useEffect)((function(){try{for(var e=0;e<B.length;e++)Ce(B[e],B[e].highlightIdx)}catch(t){}}),[B,w]),(0,L.jsxs)("main",{className:"PersonalReading",children:[(0,L.jsxs)("div",{ref:H,className:"HighlightButton__wrap",children:[(0,L.jsx)("button",{ref:R,className:"HighlightButton specific",onTouchStart:function(e){He(n,F,H,v,y,"highlightedGreen",e)},onClick:function(){He(n,F,H,v,y,"highlightedGreen")}}),(0,L.jsx)("button",{ref:D,className:"HighlightButton__purple specific",onTouchStart:function(e){He(n,F,H,v,y,"highlightedPurple",e)},onClick:function(){He(n,F,H,v,y,"highlightedPurple")}}),(0,L.jsx)("button",{ref:T,className:"HighlightButton__yellow specific",onTouchStart:function(e){He(n,F,H,v,y,"highlightedYellow",e)},onClick:function(){He(n,F,H,v,y,"highlightedYellow")}})]}),(0,L.jsxs)("div",{className:"PersonalReading__container",children:[(0,L.jsx)("aside",{className:"PersonalReading__sideBar",children:(0,L.jsx)(Ze,{commitIdx:w,setCommitIdx:N,currentBookInfo:Y})}),(0,L.jsxs)("div",{className:"PersonalReading__mainPage",style:!0===e.mode?{flex:3}:{flex:1},children:[!0===e.mode?(0,L.jsxs)("article",{className:"PersonalReading__mainPage--readingPage",style:!0===e.mode?{flex:2}:{flex:0},children:[(0,L.jsx)(U,{className:"PageRendered",html:g}),(0,L.jsxs)("div",{className:"PersonalReading__mainPage--goBackButtons",children:[(0,L.jsx)(Q.G,{icon:X.Uu6,className:"backButton",onClick:function(){Re("back",F,O,Y.totalPage)}}),(0,L.jsx)(Q.G,{icon:X.I4f,className:"goButton",onClick:function(){Re("go",F,O,Y.totalPage)}})]}),(0,L.jsx)("div",{className:"PersonalReading__mainPage--info",children:(0,L.jsxs)("p",{children:[(0,L.jsx)("input",{className:"PersonalReading__mainPage--info--input",placeholder:F,onKeyUp:function(e){e.preventDefault(),13===window.event.keyCode&&1<=e.target.value&&e.target.value<=Y.totalPage&&(O(Number(e.target.value)),e.target.value=null)}})," / ",Y.totalPage]})})]}):null,(0,L.jsx)("aside",{className:"PersonalReading__highlightList",style:(e.mode,{flex:1}),children:(0,L.jsx)(se,{commitIdx:w,setCommitIdx:N,pdfIdx:n,totalPage:Y.totalPage,currentPageNumber:F,updateHighlightList:v,setUpdateHighlightList:y})})]}),(0,L.jsxs)("article",{className:"PersonalReading__mainPage--textEditor",style:(e.mode,{flex:1}),children:[(0,L.jsxs)("div",{className:"PersonalReading__mainPage--textEditor--wrap",children:[(0,L.jsxs)("div",{className:"PersonalReading__mainPage--textEditor--info",children:[(0,L.jsx)("h1",{children:Y.pdfName}),(0,L.jsx)("p",{children:Y.author})]}),(0,L.jsx)(Q.G,{className:"ToPdfButton",icon:X.gSj,onClick:function(){setTimeout((function(){!function(e){var t,n,r,i;null===(t=document.querySelector(".editor"))||void 0===t||t.setAttribute("style","overflow: visible !important"),null===(n=document.querySelector(".editor"))||void 0===n||n.setAttribute("style","height: auto !important");var o=new Array,a=15;function s(e,t,n,r){var i=.2645*f()(r).outerWidth(),a=.2645*f()(r).outerHeight()*180/i;Le()(r).then((function(t){var r=t.toDataURL("image/jpeg",1);o.push({num:e,image:r,height:a}),n.resolve()}))}!function(){var t=document.querySelectorAll(".editor > *");console.log(t);for(var n=[],r=new Ee.ZP("p","mm","a4"),i=0;i<t.length;i++){var c=f().Deferred();n.push(c.promise()),s(i,r,c,t[i])}f().when.apply(f(),n).then((function(){for(var t=o.sort((function(e,t){return e.num<t.num?-1:1})),n=a,i=0;i<t.length;i++){var s=t[i].height,c=t[i].image;n+s>267?(r.addPage(),n=a,r.addImage(c,"jpeg",a,n,180,s),n+=s):(r.addImage(c,"jpeg",a,n,180,s),n+=s)}r.save("".concat(e,".pdf")),n=a,o=new Array}))}(),null===(r=document.querySelector(".editor"))||void 0===r||r.setAttribute("style","overflow: scroll !important"),null===(i=document.querySelector(".editor"))||void 0===i||i.setAttribute("style","height: 100% !important")}(Y.pdfName)}),100)}})]}),(0,L.jsx)(E,{markdownValue:b,commitIdx:w,userIdx:String(58),pdfIdx:String(n)})]})]})]})}}}]);
//# sourceMappingURL=891.8858b191.chunk.js.map